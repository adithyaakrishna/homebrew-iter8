name: Update brew formula

on:
  repository_dispatch:
    types: [release]

jobs:
  update-brew:
    name: Update brew formula
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - run: |
        export VERSION=${{ github.event.client_payload.ref }}
        export REVISION=${{ github.event.client_payload.sha }}
        envsubst < iter8.rb.tpl > iter8.rb
    - uses: stefanzweifel/git-auto-commit-action@v4
      with:
        commit_message: Apply changes to brew formula        
